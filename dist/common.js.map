{"version":3,"file":"common.js","sources":["webpack:///._src_api_home.ts","webpack:///._src_api_house.ts","webpack:///._src_api_my.ts","webpack:///._src_constants_status.js","webpack:///._src_pages_home_images_fb.png","webpack:///._src_pages_house_redux.ts","webpack:///._src_pages_in_redux.ts","webpack:///._src_utils_common.ts","webpack:///._src_utils_env.ts","webpack:///._src_utils_error.ts","webpack:///._src_utils_http.ts"],"sourcesContent":["import Http from '../utils/http'\r\nimport { HTTP_VERSION } from '../constants/status'\r\n\r\nexport const userLogin = params => Http.post(`/wechat/${HTTP_VERSION}/userLogin`, params)","import Http from '../utils/http'\r\nimport { HTTP_VERSION } from '../constants/status'\r\n\r\nexport const getHouse = params => Http.post(`/house/${HTTP_VERSION}/list`, params)\r\nexport const addHouse = params => Http.post(`/house/${HTTP_VERSION}/add`, params)\r\nexport const queryHouseDetail = params => Http.post(`/house/${HTTP_VERSION}/detail`, params)","import Http from '../utils/http'\r\nimport { HTTP_VERSION } from '../constants/status'\r\n\r\nexport const userInfo = params => Http.post(`/user/${HTTP_VERSION}/info`, params)","export const HTTP_STATUS = {\r\n  SUCCESS: 200,\r\n  CREATED: 201,\r\n  ACCEPTED: 202,\r\n  CLIENT_ERROR: 400,\r\n  AUTHENTICATE: 301,\r\n  FORBIDDEN: 403,\r\n  NOT_FOUND: 404,\r\n  SERVER_ERROR: 500,\r\n  BAD_GATEWAY: 502,\r\n  SERVICE_UNAVAILABLE: 503,\r\n  GATEWAY_TIMEOUT: 504\r\n}\r\n  \r\nexport const REFRESH_STATUS = {\r\n  NORMAL: 0,\r\n  REFRESHING: 1,\r\n  NO_MORE_DATA: 2\r\n}\r\n\r\nexport const HTTP_VERSION = 'v1'\r\n  ","module.exports = __webpack_public_path__ + \"pages/home/images/fb.png\";","import { getHouse } from '../../api/house'\r\n\r\n// Actions\r\nconst UPDATE = 'HOUSE_UPDATE'\r\n\r\n// Reducer\r\nconst initState = {\r\n  list: [],\r\n}\r\n\r\nexport default (state = initState, action) => {\r\n  switch (action.type) {\r\n    case UPDATE:\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\n// Action Creators\r\nexport const houseUpdate = params => ({\r\n  payload: params,\r\n  type: UPDATE,\r\n})\r\n\r\n// \"emptyRoomCount\": 0,\r\n//  \"houseId\": 0,\r\n//  \"name\": \"string\",\r\n//  \"roomCount\": 0\r\nexport const getHouseList = () => async(dispatch) => {\r\n  const { data } = await getHouse({})\r\n  dispatch(houseUpdate({\r\n    list: data.data.length > 0 ?  data.data : [{\r\n      emptyRoomCount: 6,\r\n      houseId: 6,\r\n      name: \"红木林南1号楼\",\r\n      roomCount: 10\r\n    }],\r\n  }))\r\n}\r\n","import Taro from '@tarojs/taro'\r\nimport { userLogin } from '../../api/home'\r\nimport { userInfo } from '../../api/my'\r\n\r\n// Actions\r\nconst UPDATE = 'GLOBAL_UPDATE'\r\n\r\n// Reducer\r\nconst initState = {\r\n  init: false,\r\n  userInfo: {\r\n    token: '',\r\n    headImageUrl: '',\r\n    nickName: '',\r\n  },\r\n}\r\n\r\nexport default (state = initState, action) => {\r\n  switch (action.type) {\r\n    case UPDATE:\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\n// Action Creators\r\nexport const globalUpdate = params => ({\r\n  payload: params,\r\n  type: UPDATE,\r\n})\r\n\r\nexport const codeForOpenId = () => async (dispatch) => {\r\n  Taro.login({\r\n    success: async function (res) {\r\n      if (res.code) {\r\n        //发起网络请求\r\n        try {\r\n          const { data } = await userLogin({jsCode: res.code}) || {}\r\n          dispatch(globalUpdate({\r\n            token: data.peaceToken\r\n          }))\r\n          Taro.setStorageSync('Peace-X-Token', data.peaceToken)\r\n          Taro.redirectTo({\r\n            url: '/pages/home/index'\r\n          })\r\n        } catch (err) {\r\n          console.log(`请求接口userLogin失败：${err}`)\r\n        }\r\n      } else {\r\n        console.log('登录失败！' + res.errMsg)\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n\r\nexport const getUserInfo = () => async(dispatch) => {\r\n  const { headImageUrl, nickName } = await userInfo({}) || {}\r\n  dispatch(globalUpdate({\r\n    headImageUrl,\r\n    nickName,\r\n  }))\r\n}\r\n","\r\nexport const formatNumber = (n: number | string) : string => {\r\n  n = n.toString()\r\n  return n[1] ? n : '0' + n\r\n}\r\n\r\nexport const formatTime = date => {\r\n  const year = date.getFullYear()\r\n  const month = date.getMonth() + 1\r\n  const day = date.getDate()\r\n  const hour = date.getHours()\r\n  const minute = date.getMinutes()\r\n  const second = date.getSeconds()\r\n\r\n  return [year, month, day].map(formatNumber).join('-') + ' ' + [hour, minute, second].map(formatNumber).join(':')\r\n}\r\n\r\n// 格式化时间戳为日期\r\nexport const formatTimeStampToTime = (timestamp) => {\r\n  const date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000\r\n  const year = date.getFullYear();\r\n  const month = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1);\r\n  const day = date.getDate() < 10 ? `0${date.getDate()}` : date.getDate();\r\n  // const hour = date.getHours() + ':';\r\n  // const minutes = date.getMinutes() + ':';\r\n  // const second = date.getSeconds();\r\n  return `${year}-${month}-${day}`\r\n}\r\n","const config = {\r\n  development: {\r\n    baseUrl: 'http://129.211.51.16:8080',\r\n  },\r\n  production: {\r\n    baseUrl: 'http://129.211.51.16:8080',\r\n  },\r\n}\r\nconst env = config[process.env.NODE_ENV]\r\n\r\nexport default env","import { formatTime } from './common'\r\n/**\r\n *\r\n * @param {string} name 错误名字\r\n * @param {string} action 错误动作描述\r\n * @param {string} info 错误信息，通常是 fail 返回的\r\n */\r\n// eslint-disable-next-line\r\nexport const logError = (name: string, action: string, info?: string | object ) => {\r\n  if (!info) {\r\n    info = 'empty'\r\n  }\r\n  let time = formatTime(new Date())\r\n  console.error(time, name, action, info)\r\n  if (typeof info === 'object') {\r\n    info = JSON.stringify(info)\r\n  }\r\n}\r\n\r\n","import Taro from '@tarojs/taro'\r\nimport { HTTP_STATUS } from '../constants/status'\r\nimport env from './env'\r\nimport { logError } from './error'\r\n\r\nconst { baseUrl } = env\r\n\r\nexport default {\r\n  baseOptions(params, method = 'GET') {\r\n    let { url, data } = params\r\n    let contentType = 'application/json'\r\n    contentType = params.contentType || contentType\r\n    type OptionType = {\r\n      url: string,\r\n      data?: object | string,\r\n      method?: any,\r\n      header: object,\r\n      // mode: string,\r\n      success: any,\r\n      error: any,\r\n      xhrFields: object,\r\n    }\r\n    const option: OptionType = {\r\n      url: url.indexOf('http') !== -1 ? url : baseUrl + url,\r\n      data: data,\r\n      method: method,\r\n      header: {\r\n        'content-type': contentType,\r\n        'Peace-X-Token': Taro.getStorageSync('Peace-X-Token') || 'AAAA'\r\n      },\r\n      // mode: 'cors',\r\n      xhrFields: { withCredentials: true },\r\n      success(res) {\r\n        if (res.statusCode === HTTP_STATUS.NOT_FOUND) {\r\n          return logError('api', '请求资源不存在')\r\n        } else if (res.statusCode === HTTP_STATUS.BAD_GATEWAY) {\r\n          return logError('api', '服务端出现了问题')\r\n        } else if (res.statusCode === HTTP_STATUS.FORBIDDEN) {\r\n          return logError('api', '没有权限访问')\r\n        } else if (res.statusCode === HTTP_STATUS.AUTHENTICATE) {\r\n          Taro.clearStorage()\r\n          Taro.navigateTo({\r\n            url: '/pages/packageA/pages/login/index'\r\n          })\r\n          return logError('api', '请先登录')\r\n        } else if (res.statusCode === HTTP_STATUS.SUCCESS) {\r\n          return res.data\r\n        }\r\n      },\r\n      error(e) {\r\n        logError('api', '请求接口出现问题', e)\r\n      }\r\n    }\r\n    // eslint-disable-next-line\r\n    return Taro.request(option)\r\n  },\r\n  get(url, data?: object) {\r\n    let option = { url, data }\r\n    return this.baseOptions(option)\r\n  },\r\n  post: function (url, data?: object, contentType?: string) {\r\n    let params = { url, data, contentType }\r\n    return this.baseOptions(params, 'POST')\r\n  },\r\n  put(url, data?: object) {\r\n    let option = { url, data }\r\n    return this.baseOptions(option, 'PUT')\r\n  },\r\n  delete(url, data?: object) {\r\n    let option = { url, data }\r\n    return this.baseOptions(option, 'DELETE')\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;ACpBA;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AAIA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AAIA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;A","sourceRoot":""}